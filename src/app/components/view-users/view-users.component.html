<!-- view-users.component.html -->
<div class="container-fluid mt-3 mt-md-4 px-2 px-sm-3">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-2 py-md-3">
      <h4 class="mb-0 fs-5 fs-md-4">
        <i class="bi bi-people-fill me-1 me-md-2"></i><span class="d-none d-sm-inline">User</span> Management
      </h4>
      <button class="btn btn-light btn-sm refresh-button" (click)="refreshData()" [disabled]="loading">
        <i class="bi bi-arrow-clockwise me-1"></i><span class="d-none d-md-inline">Refresh</span>
      </button>
    </div>
    
    <!-- Search and Filter Section -->
    <div class="card-body border-bottom bg-light p-2 p-sm-3">
      <!-- Search Bar -->
      <div class="row mb-3">
        <div class="col-12">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input 
              type="text" 
              class="form-control border-start-0" 
              placeholder="Search by name, email, phone, ID..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
            >
            <button 
              class="btn btn-outline-secondary" 
              type="button" 
              (click)="searchTerm = ''; onSearchChange()"
              *ngIf="searchTerm"
            >
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>
        <div class="col-12 d-flex justify-content-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" (click)="clearFilters()">
            <i class="bi bi-funnel me-1"></i> Clear Filters
          </button>
        </div>
      </div>

      <!-- Filter Dropdowns -->
      <div class="row g-2">
        <div class="col-6 col-md-3 mb-2">
          <label class="form-label small text-muted">Region</label>
          <select 
            class="form-select form-select-sm" 
            [(ngModel)]="selectedRegion"
            (change)="onFilterChange()"
          >
            <option *ngFor="let region of regionOptions" [value]="region">
              {{ region }}
            </option>
          </select>
        </div>
        <div class="col-6 col-md-3 mb-2">
          <label class="form-label small text-muted">Level</label>
          <select 
            class="form-select form-select-sm" 
            [(ngModel)]="selectedLevel"
            (change)="onFilterChange()"
          >
            <option *ngFor="let level of levelOptions" [value]="level.value">
              {{ level.label }}
            </option>
          </select>
        </div>
        <div class="col-6 col-md-3 mb-2">
          <label class="form-label small text-muted">Status</label>
          <select 
            class="form-select form-select-sm" 
            [(ngModel)]="selectedStatus"
            (change)="onFilterChange()"
          >
            <option *ngFor="let status of statusOptions" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
        </div>
        <div class="col-6 col-md-3 mb-2 d-flex align-items-end">
          <small class="text-muted">
            {{ filteredUsers.length }} of {{ users.length }} users
          </small>
        </div>
      </div>
    </div>
    
    <div class="card-body p-0">
      <!-- Loading spinner -->
      <div *ngIf="loading" class="text-center py-4 py-md-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading users...</p>
      </div>
      
      <!-- Error message -->
      <div *ngIf="error" class="alert alert-danger mx-2 mx-md-3 my-3 d-flex align-items-center" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <div>{{ error }}</div>
      </div>
      
      <!-- Desktop User Table (hidden on small screens) -->
      <div *ngIf="!loading && !error" class="table-responsive d-none d-lg-block" style="max-height: 600px; overflow-y: auto;">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-dark sticky-top">
            <tr>
              <th scope="col" class="text-center">#</th>
              <th scope="col" class="sortable-header" (click)="sortBy('name')">
                User Info
                <i class="bi ms-1" [ngClass]="getSortIcon('name')"></i>
              </th>
              <th scope="col" class="sortable-header" (click)="sortBy('email')">
                Contact
                <i class="bi ms-1" [ngClass]="getSortIcon('email')"></i>
              </th>
              <th scope="col" class="text-center sortable-header" (click)="sortBy('level')">
                Level
                <i class="bi ms-1" [ngClass]="getSortIcon('level')"></i>
              </th>
              <th scope="col" class="text-center sortable-header" (click)="sortBy('status')">
                Status
                <i class="bi ms-1" [ngClass]="getSortIcon('status')"></i>
              </th>
              <th scope="col">Region</th>
              <th scope="col" class="text-center sortable-header" (click)="sortBy('wallet')">
                Wallet
                <i class="bi ms-1" [ngClass]="getSortIcon('wallet')"></i>
              </th>
              <th scope="col">Referral Info</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers; trackBy: trackByUserId">
              <!-- User ID -->
              <td class="text-center align-middle">
                <span class="badge bg-secondary">{{ user.id }}</span>
              </td>
              
              <!-- User Info -->
              <td class="align-middle">
                <div class="d-flex flex-column">
                  <strong class="text-primary">{{ user.name }}</strong>
                  <small class="text-muted">{{ user.email }}</small>
                </div>
              </td>
              
              <!-- Contact -->
              <td class="align-middle">
                <div class="d-flex flex-column">
                  <span class="fw-medium">{{ user.phoneNumber }}</span>
                  <small class="text-muted" *ngIf="user.phone && user.phone !== user.phoneNumber">
                    Alt: {{ user.phone }}
                  </small>
                </div>
              </td>
              
              <!-- Level -->
              <td class="text-center align-middle">
                <span *ngIf="user.level" class="badge rounded-pill" 
                      [ngClass]="{
                        'bg-success': user.level.id === 1,
                        'bg-warning text-dark': user.level.id === 2,
                        'bg-info': user.level.id === 3
                      }">
                  {{ getLevelDisplay(user.level) }}
                </span>
                <span *ngIf="!user.level" class="badge bg-secondary">No Level</span>
              </td>
              
              <!-- Status -->
              <td class="text-center align-middle">
                <span [ngClass]="getBlockedStatusClass(user)">
                  {{ getBlockedStatus(user) }}
                </span>
              </td>
              
              <!-- Region -->
              <td class="align-middle">
                <div class="d-flex flex-column">
                  <span class="fw-medium">{{ getDefaultAddress(user) }}</span>
                  <small class="text-muted" *ngIf="user.addresses.length > 1">
                    +{{ user.addresses.length - 1 }} more
                  </small>
                  <small class="text-muted" *ngIf="user.addresses.length === 0">
                    No addresses
                  </small>
                </div>
              </td>
              
              <!-- Wallet -->
              <td class="text-center align-middle">
                <span class="fw-bold" 
                      [ngClass]="{
                        'text-success': user.wallet && user.wallet.balance > 0,
                        'text-muted': !user.wallet || user.wallet.balance === 0,
                        'text-danger': user.wallet && user.wallet.balance < 0
                      }">
                  {{ getWalletBalance(user) }}
                </span>
              </td>
              
              <!-- Referral Info -->
              <td class="align-middle">
                <div class="d-flex flex-column">
                  <small *ngIf="user.referralCode" class="text-primary">
                    <i class="bi bi-qr-code me-1"></i>{{ user.referralCode }}
                  </small>
                  <small *ngIf="user.referredBy" class="text-info">
                    <i class="bi bi-person-plus me-1"></i>{{ user.referredBy }}
                  </small>
                  <small *ngIf="!user.referralCode && !user.referredBy" class="text-muted">
                    No referral data
                  </small>
                </div>
              </td>
              
              <!-- Actions -->
              <td class="text-center align-middle">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-primary" 
                          (click)="viewUserDetails(user)"
                          title="View Details">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-secondary" 
                          (click)="editUser(user)"
                          title="Edit User">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button class="btn" 
                          [ngClass]="user.isBlocked || user.blocked ? 'btn-outline-success' : 'btn-outline-danger'"
                          (click)="toggleUserBlock(user)"
                          [title]="user.isBlocked || user.blocked ? 'Unblock User' : 'Block User'">
                    <i [ngClass]="user.isBlocked || user.blocked ? 'bi bi-unlock' : 'bi bi-lock'"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Mobile Card View (visible only on small and medium screens) -->
      <div *ngIf="!loading && !error" class="d-lg-none">
        <div class="row g-3">
          <div *ngFor="let user of filteredUsers; trackBy: trackByUserId" class="col-12">
            <div class="card h-100 shadow-sm">
              <div class="card-header d-flex justify-content-between align-items-center py-2">
                <div class="d-flex align-items-center">
                  <span class="badge bg-secondary me-2">{{ user.id }}</span>
                  <h5 class="card-title mb-0 text-primary">{{ user.name }}</h5>
                </div>
                <span *ngIf="user.level" class="badge rounded-pill" 
                      [ngClass]="{
                        'bg-success': user.level.id === 1,
                        'bg-warning text-dark': user.level.id === 2,
                        'bg-info': user.level.id === 3
                      }">
                  {{ getLevelDisplay(user.level) }}
                </span>
                <span *ngIf="!user.level" class="badge bg-secondary">No Level</span>
              </div>
              <div class="card-body py-2">
                <div class="row g-2">
                  <!-- Contact Info -->
                  <div class="col-12">
                    <div class="d-flex align-items-center mb-2">
                      <i class="bi bi-envelope-fill text-muted me-2"></i>
                      <small>{{ user.email }}</small>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                      <i class="bi bi-telephone-fill text-muted me-2"></i>
                      <small>{{ user.phoneNumber }}</small>
                    </div>
                  </div>
                  
                  <!-- Status & Region -->
                  <div class="col-6">
                    <div class="mb-2">
                      <small class="text-muted d-block">Status:</small>
                      <span [ngClass]="getBlockedStatusClass(user)">
                        {{ getBlockedStatus(user) }}
                      </span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-2">
                      <small class="text-muted d-block">Region:</small>
                      <span class="fw-medium">{{ getDefaultAddress(user) }}</span>
                    </div>
                  </div>
                  
                  <!-- Wallet & Referral -->
                  <div class="col-6">
                    <div class="mb-2">
                      <small class="text-muted d-block">Wallet:</small>
                      <span class="fw-bold" 
                            [ngClass]="{
                              'text-success': user.wallet && user.wallet.balance > 0,
                              'text-muted': !user.wallet || user.wallet.balance === 0,
                              'text-danger': user.wallet && user.wallet.balance < 0
                            }">
                        {{ getWalletBalance(user) }}
                      </span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-2" *ngIf="user.referralCode || user.referredBy">
                      <small class="text-muted d-block">Referral:</small>
                      <small *ngIf="user.referralCode" class="text-primary d-block">
                        <i class="bi bi-qr-code me-1"></i>{{ user.referralCode }}
                      </small>
                      <small *ngIf="user.referredBy" class="text-info d-block">
                        <i class="bi bi-person-plus me-1"></i>{{ user.referredBy }}
                      </small>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer py-2">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-sm btn-outline-primary" (click)="viewUserDetails(user)">
                    <i class="bi bi-eye me-1"></i> View
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" (click)="editUser(user)">
                    <i class="bi bi-pencil-square me-1"></i> Edit
                  </button>
                  <button class="btn btn-sm" 
                          [ngClass]="user.isBlocked || user.blocked ? 'btn-outline-success' : 'btn-outline-danger'"
                          (click)="toggleUserBlock(user)">
                    <i [ngClass]="user.isBlocked || user.blocked ? 'bi bi-unlock me-1' : 'bi bi-lock me-1'"></i>
                    {{ user.isBlocked || user.blocked ? 'Unblock' : 'Block' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- No users message -->
      <div *ngIf="!loading && !error && filteredUsers.length === 0 && users.length > 0" class="text-center py-4 py-md-5">
        <i class="bi bi-search text-muted" style="font-size: 2.5rem;"></i>
        <p class="text-muted mt-3">No users found matching your search criteria</p>
        <button class="btn btn-outline-primary btn-sm px-3" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
      
      <!-- No users at all -->
      <div *ngIf="!loading && !error && users.length === 0" class="text-center py-4 py-md-5">
        <i class="bi bi-people text-muted" style="font-size: 2.5rem;"></i>
        <p class="text-muted mt-3">No users found in the system</p>
        <button class="btn btn-outline-primary btn-sm px-3" (click)="refreshData()">
          Try Again
        </button>
      </div>
    </div>
  </div>
</div>
  
<!-- User Details Modal -->
<div class="modal fade" [class.show]="showUserModal" [style.display]="showUserModal ? 'block' : 'none'" 
     tabindex="-1" role="dialog" aria-labelledby="userDetailsModalLabel" aria-hidden="true"
     *ngIf="showUserModal && selectedUser">
  <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="userDetailsModalLabel">
          <i class="bi bi-person-circle me-2"></i>User Details - {{ selectedUser.name }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeUserModal()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-4">
          <!-- Personal Information -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bi bi-person-fill me-2"></i>Personal Information</h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-12">
                    <label class="form-label fw-bold text-muted">User ID</label>
                    <p class="mb-0"><span class="badge bg-secondary">{{ selectedUser.id }}</span></p>
                  </div>
                  <div class="col-12">
                    <label class="form-label fw-bold text-muted">Full Name</label>
                    <p class="mb-0">{{ selectedUser.name }}</p>
                  </div>
                  <div class="col-12">
                    <label class="form-label fw-bold text-muted">Email Address</label>
                    <p class="mb-0">
                      {{ selectedUser.email }}
                      <span class="badge bg-success ms-2" *ngIf="selectedUser.emailVerified || selectedUser.isEmailVerified">
                        <i class="bi bi-check-circle me-1"></i>Verified
                      </span>
                    </p>
                  </div>
                  <div class="col-12">
                    <label class="form-label fw-bold text-muted">Phone Number</label>
                    <p class="mb-0">{{ selectedUser.phoneNumber }}</p>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.companyName">
                    <label class="form-label fw-bold text-muted">Company Name</label>
                    <p class="mb-0">{{ selectedUser.companyName }}</p>
                  </div>
                  <div class="col-6">
                    <label class="form-label fw-bold text-muted">Level</label>
                    <p class="mb-0">
                      <span *ngIf="selectedUser.level" class="badge rounded-pill" 
                            [ngClass]="{
                              'bg-success': selectedUser.level.id === 1,
                              'bg-warning text-dark': selectedUser.level.id === 2,
                              'bg-info': selectedUser.level.id === 3
                            }">
                        {{ getLevelDisplay(selectedUser.level) }}
                      </span>
                      <span *ngIf="selectedUser.levelAlias" class="text-muted ms-2">({{ selectedUser.levelAlias }})</span>
                    </p>
                  </div>
                  <div class="col-6">
                    <label class="form-label fw-bold text-muted">Status</label>
                    <p class="mb-0">
                      <span [ngClass]="getBlockedStatusClass(selectedUser)">
                        {{ getBlockedStatus(selectedUser) }}
                      </span>
                    </p>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.createdAt">
                    <label class="form-label fw-bold text-muted">Account Created</label>
                    <p class="mb-0">{{ formatDate(selectedUser.createdAt) }}</p>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.updatedAt">
                    <label class="form-label fw-bold text-muted">Last Updated</label>
                    <p class="mb-0">{{ formatDate(selectedUser.updatedAt) }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Addresses -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-geo-alt-fill me-2"></i>Addresses</h6>
                <span class="badge bg-primary">{{ selectedUser.addresses?.length || 0 }}</span>
              </div>
              <div class="card-body">
                <div *ngIf="selectedUser.addresses && selectedUser.addresses.length > 0; else noAddresses">
                  <div *ngFor="let address of selectedUser.addresses; let i = index" 
                       class="border rounded p-3 mb-3" [class.border-primary]="address.defaultAddress">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h6 class="mb-0">Address {{ i + 1 }}</h6>
                      <span *ngIf="address.defaultAddress" class="badge bg-primary">Default</span>
                    </div>
                    <p class="mb-1"><strong>{{ address.address }}</strong></p>
                    <p class="mb-1">{{ address.landmark }}, {{ address.city }}</p>
                    <p class="mb-1">{{ address.state }} - {{ address.pincode }}</p>
                    <small class="text-muted">
                      <i class="bi bi-geo me-1"></i>{{ address.latitude }}, {{ address.longitude }}
                    </small>
                  </div>
                </div>
                <ng-template #noAddresses>
                  <div class="text-center text-muted py-3">
                    <i class="bi bi-geo-alt" style="font-size: 2rem;"></i>
                    <p class="mt-2 mb-0">No addresses found</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Wallet Information -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bi bi-wallet2 me-2"></i>Wallet Information</h6>
              </div>
              <div class="card-body">
                <div *ngIf="selectedUser.wallet; else noWallet">
                  <div class="text-center py-3">
                    <h3 class="mb-2" 
                        [ngClass]="{
                          'text-success': selectedUser.wallet.balance > 0,
                          'text-muted': selectedUser.wallet.balance === 0,
                          'text-danger': selectedUser.wallet.balance < 0
                        }">
                      â‚¹{{ selectedUser.wallet.balance | number:'1.2-2' }}
                    </h3>
                    <p class="text-muted mb-0">Current Balance</p>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-6">
                      <label class="form-label fw-bold text-muted">Wallet ID</label>
                      <p class="mb-0">{{ selectedUser.wallet.id }}</p>
                    </div>
                  </div>
                </div>
                <ng-template #noWallet>
                  <div class="text-center text-muted py-3">
                    <i class="bi bi-wallet2" style="font-size: 2rem;"></i>
                    <p class="mt-2 mb-0">No wallet information</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Bank Accounts -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-bank me-2"></i>Bank Accounts</h6>
                <span class="badge bg-primary">{{ selectedUser.bankAccounts?.length || 0 }}</span>
              </div>
              <div class="card-body">
                <div *ngIf="selectedUser.bankAccounts && selectedUser.bankAccounts.length > 0; else noBankAccounts">
                  <div *ngFor="let account of selectedUser.bankAccounts; let i = index" 
                       class="border rounded p-3 mb-3" [class.border-success]="account.isPrimary || account.primary">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h6 class="mb-0">Account {{ i + 1 }}</h6>
                      <div>
                        <span *ngIf="account.isPrimary || account.primary" class="badge bg-success me-1">Primary</span>
                        <span *ngIf="account.isActive || account.active" class="badge bg-info">Active</span>
                      </div>
                    </div>
                    <div class="row g-2">
                      <div class="col-12">
                        <label class="form-label fw-bold text-muted small">Account Holder</label>
                        <p class="mb-1">{{ account.accountHolderName }}</p>
                      </div>
                      <div class="col-12">
                        <label class="form-label fw-bold text-muted small">Account Number</label>
                        <p class="mb-1 font-monospace">{{ account.accountNumber }}</p>
                      </div>
                      <div class="col-6">
                        <label class="form-label fw-bold text-muted small">Bank</label>
                        <p class="mb-1">{{ account.bankName }}</p>
                      </div>
                      <div class="col-6">
                        <label class="form-label fw-bold text-muted small">Branch</label>
                        <p class="mb-1">{{ account.branchName }}</p>
                      </div>
                      <div class="col-6">
                        <label class="form-label fw-bold text-muted small">IFSC Code</label>
                        <p class="mb-1 font-monospace">{{ account.ifscCode }}</p>
                      </div>
                      <div class="col-6">
                        <label class="form-label fw-bold text-muted small">Account Type</label>
                        <p class="mb-1">{{ getBankAccountType(account.accountType) }}</p>
                      </div>
                      <div class="col-12" *ngIf="account.upiId">
                        <label class="form-label fw-bold text-muted small">UPI ID</label>
                        <p class="mb-1">{{ account.upiId }}</p>
                      </div>
                      <div class="col-12" *ngIf="account.beneficiaryRegistered">
                        <label class="form-label fw-bold text-muted small">Beneficiary Status</label>
                        <p class="mb-1">
                          <span class="badge bg-success">Registered</span>
                          <span *ngIf="account.beneficiaryId" class="text-muted ms-2">ID: {{ account.beneficiaryId }}</span>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <ng-template #noBankAccounts>
                  <div class="text-center text-muted py-3">
                    <i class="bi bi-bank" style="font-size: 2rem;"></i>
                    <p class="mt-2 mb-0">No bank accounts found</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Referral Information -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bi bi-share me-2"></i>Referral Information</h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-12" *ngIf="selectedUser.referralCode">
                    <label class="form-label fw-bold text-muted">Referral Code</label>
                    <p class="mb-0">
                      <span class="badge bg-primary fs-6">{{ selectedUser.referralCode }}</span>
                    </p>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.referredBy">
                    <label class="form-label fw-bold text-muted">Referred By</label>
                    <p class="mb-0">{{ selectedUser.referredBy }}</p>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.rewardsAsReferrer && selectedUser.rewardsAsReferrer.length > 0">
                    <label class="form-label fw-bold text-muted">Rewards as Referrer</label>
                    <div class="badge bg-success">{{ selectedUser.rewardsAsReferrer.length }} rewards</div>
                  </div>
                  <div class="col-12" *ngIf="selectedUser.rewardsAsReferredUser && selectedUser.rewardsAsReferredUser.length > 0">
                    <label class="form-label fw-bold text-muted">Rewards as Referred User</label>
                    <div class="badge bg-info">{{ selectedUser.rewardsAsReferredUser.length }} rewards</div>
                  </div>
                  <div class="col-12" *ngIf="!selectedUser.referralCode && !selectedUser.referredBy">
                    <div class="text-center text-muted py-3">
                      <i class="bi bi-share" style="font-size: 2rem;"></i>
                      <p class="mt-2 mb-0">No referral information</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- KYC Verification -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bi bi-shield-check me-2"></i>KYC Verification</h6>
              </div>
              <div class="card-body">
                <div *ngIf="selectedUser.kycVerification; else noKyc">
                  <!-- KYC details would go here if available -->
                  <p class="mb-0">KYC verification details available</p>
                </div>
                <ng-template #noKyc>
                  <div class="text-center text-muted py-3">
                    <i class="bi bi-shield-x" style="font-size: 2rem;"></i>
                    <p class="mt-2 mb-0">No KYC verification data</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeUserModal()">
          <i class="bi bi-x-circle me-1"></i>Close
        </button>
        <button type="button" class="btn btn-primary" (click)="editUser(selectedUser)">
          <i class="bi bi-pencil-square me-1"></i>Edit User
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="showUserModal" *ngIf="showUserModal" (click)="closeUserModal()"></div>
